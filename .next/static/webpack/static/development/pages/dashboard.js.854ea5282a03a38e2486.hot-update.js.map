{"version":3,"file":"static/webpack/static/development/pages/dashboard.js.854ea5282a03a38e2486.hot-update.js","sources":["webpack:///./components/vendor/allEnquiries.js"],"sourcesContent":["import React, { Component } from \"react\";\nimport axios from \"axios\";\nimport {\n  Row,\n  Col,\n  Card,\n  Drawer,\n  List,\n  Avatar,\n  Button,\n  Skeleton,\n  Modal,\n  Table,\n  Popover,\n  Icon\n} from \"antd\";\nimport moment from \"moment\";\nimport Link from \"next/link\";\n\nimport reqwest from \"reqwest\";\nimport { withRouter } from \"next/router\";\nconst { Meta } = Card;\n\nclass AllEnquiries extends Component {\n  componentDidMount() {}\n  state = {\n    drawerVisible: false,\n    currentId: \"\",\n    currentEnquiry: {},\n    initLoading: true,\n    loading: false,\n    enquiries: [],\n    list: [],\n    count: 0,\n    junk: \"\"\n  };\n  componentWillMount() {\n    this.setState({\n      profile: this.props.profile\n    });\n  }\n  componentDidMount() {\n    this.getData(res => {\n      this.setState({\n        initLoading: false,\n        enquiries: res,\n        list: res,\n        count: this.state.count + 2\n      });\n    });\n    this.props.router.query.enquiry\n      ? axios\n          .get(\n            \"/api/enquiries/currentEnquiry/\" + this.props.router.query.enquiry\n          )\n          .then(enquiry =>\n            this.setState({ currentEnquiry: enquiry.data, drawerVisible: true })\n          )\n      : null;\n    var aScript = document.createElement(\"script\");\n    aScript.type = \"text/javascript\";\n    aScript.src = \"https://checkout.razorpay.com/v1/checkout.js\";\n\n    document.head.appendChild(aScript);\n  }\n\n  getData = callback => {\n    axios\n      .get(`/api/enquiries/allEnquiries/2/${this.state.count}`)\n      .then(res => callback(res));\n  };\n\n  onLoadMore = () => {\n    this.setState({\n      loading: true,\n      count: this.state.count + 2\n    });\n    this.getData(res => {\n      const enquiries = this.state.enquiries.concat(res);\n      this.setState(\n        {\n          enquiries,\n          loading: false\n        },\n        () => {\n          // Resetting window's offsetTop so as to display react-virtualized demo underfloor.\n          // In real scene, you can using public method of react-virtualized:\n          // https://stackoverflow.com/questions/46700726/how-to-use-public-method-updateposition-of-react-virtualized\n          window.dispatchEvent(new Event(\"resize\"));\n        }\n      );\n    });\n  };\n\n  openEnquiryDrawer = id => {\n    this.setState({ drawerVisible: true, currentId: id });\n    axios\n      .get(\"/api/enquiries/currentEnquiry/\" + id)\n      .then(enquiry => this.setState({ currentEnquiry: enquiry.data }));\n  };\n  onClose = () => {\n    this.setState({\n      drawerVisible: false\n    });\n    this.props.router.push(\"/dashboard\");\n  };\n  payForLead = () => {\n    const { currentEnquiry } = this.state;\n    const { profile } = this.state;\n    if (\n      currentEnquiry.leadAmount - (profile.Wallet + profile.promoCredit) <=\n      0\n    ) {\n      axios\n        .post(\n          \"/api/enquiries/updatePayment/\" +\n            currentEnquiry._id +\n            \"/\" +\n            profile._id\n        )\n        .then(enquiry => {\n          const index = this.state.enquiries.findIndex(\n            x => x._id === this.state.currentEnquiry._id\n          );\n\n          (this.state.enquiries[index] = enquiry.data),\n            this.setState({ currentEnquiry: enquiry.data });\n        });\n      axios\n        .post(\n          \"/api/profiles/updatePayment/\" +\n            currentEnquiry._id +\n            \"/\" +\n            profile._id +\n            \"/\" +\n            currentEnquiry.leadAmount +\n            \"/walletOrPromo\"\n        )\n        .then(profile => this.setState({ profile: profile.data }));\n    } else {\n      const options = {\n        key: \"rzp_test_lywdx0vKDyTxOh\",\n        amount:\n          (currentEnquiry.leadAmount - (profile.Wallet + profile.promoCredit)) *\n          100, // 2000 paise = INR 20\n        name: \"CelebratON.in\",\n        description:\n          currentEnquiry.category + \" enquiry by \" + currentEnquiry.user.name,\n        image: \"\",\n        handler: response => {\n          axios\n            .post(\n              \"/api/enquiries/updatePayment/\" +\n                currentEnquiry._id +\n                \"/\" +\n                profile._id\n            )\n            .then(enquiry => {\n              const index = this.state.enquiries.findIndex(\n                x => x._id === this.state.currentEnquiry._id\n              );\n\n              (this.state.enquiries[index] = enquiry.data),\n                this.setState({ currentEnquiry: enquiry.data });\n            });\n          axios\n            .post(\n              \"/api/profiles/updatePayment/\" +\n                currentEnquiry._id +\n                \"/\" +\n                profile._id +\n                \"/\" +\n                currentEnquiry.leadAmount +\n                \"/\" +\n                response.razorpay_payment_id\n            )\n            .then(profile => this.setState({ profile: profile.data }));\n        },\n        prefill: {\n          name: profile.name,\n          email: profile.email\n        },\n        notes: {\n          address: \"Paying for a lead\"\n        },\n        theme: {\n          color: \"#ba0f58\"\n        }\n      };\n\n      new Razorpay(options).open();\n    }\n  };\n  render() {\n    const { initLoading, loading, list, enquiries } = this.state;\n    const loadMore =\n      !initLoading && !loading ? (\n        <div\n          style={{\n            textAlign: \"center\",\n            marginTop: 12,\n            height: 32,\n            lineHeight: \"32px\"\n          }}\n        >\n          <Button onClick={this.onLoadMore}>Load more</Button>\n        </div>\n      ) : null;\n\n    const { router } = this.props;\n    const { currentEnquiry } = this.state;\n\n    typeof currentEnquiry.budgetRange !== \"undefined\"\n      ? null\n      : (currentEnquiry.budgetRange = { from: 0, to: 0 });\n    typeof currentEnquiry.user !== \"undefined\"\n      ? null\n      : (currentEnquiry.user = { name: \"\", email: \"\", mobile: \"\" });\n\n    return (\n      <React.Fragment>\n        <div style={{ background: \"#ECECEC\", padding: \"30px\" }}>\n          <h1 style={{ textAlign: \"center\" }}>All Enquiries</h1>\n          <List\n            className=\"demo-loadmore-list\"\n            loading={initLoading}\n            itemLayout=\"horizontal\"\n            loadMore={loadMore}\n            dataSource={enquiries}\n            grid={{\n              gutter: 16,\n              xs: 1,\n              sm: 2,\n              md: 3,\n              lg: 3,\n              xl: 3,\n              xxl: 3\n            }}\n            style={{ padding: \"10px\" }}\n            renderItem={enquiry => (\n              <List.Item onClick={() => this.openEnquiryDrawer(enquiry._id)}>\n                <Skeleton avatar title={false} loading={enquiry.loading} active>\n                  <Link href={\"/dashboard?enquiry=\" + enquiry._id}>\n                    <a>\n                      <Card\n                        hoverable\n                        title={enquiry.category}\n                        bordered={false}\n                        style={{\n                          height: \"180px\",\n                          background: enquiry.isVerified ? null : null\n                        }}\n                      >\n                        For <b>{enquiry.serviceFor}</b> <br />\n                        on{\" \"}\n                        <b>\n                          {moment(enquiry.eventDate).format(\"DD MMM, YYYY\")}\n                        </b>\n                        <br />\n                        Bought by: <b>\n                          {enquiry.interestedPartners.length}/5\n                        </b>{\" \"}\n                        vendors\n                        <Meta\n                          description={\n                            \"Posted: \" +\n                            moment(enquiry.createdAt).from(moment(Date.now()))\n                          }\n                          style={{\n                            paddingTop: \"10px\",\n                            textAlign: \"right\",\n                            position: \"relative\"\n                          }}\n                        />\n                      </Card>\n                    </a>\n                  </Link>\n                </Skeleton>\n              </List.Item>\n            )}\n          />\n\n          <Modal\n            title={currentEnquiry.category}\n            onCancel={this.onClose}\n            visible={this.state.drawerVisible}\n            style={{ textAlign: \"center\" }}\n            footer={[]}\n          >\n            <Row type=\"flex\" align=\"middle\">\n              <Col\n                style={{ textAlign: \"left\" }}\n                md={{ span: 9, offset: 3 }}\n                sm={{ span: 22, offset: 2 }}\n              >\n                <b>Customer Name: </b>\n                {currentEnquiry.user.name}\n                <br />\n                <b>Event: </b>\n                {currentEnquiry.serviceFor}\n                <br />\n                <b>Event Date: </b>{\" \"}\n                {moment(currentEnquiry.eventDate).format(\"DD MMM, YYYY\")}\n                <br />\n                <b>No. of Guests: </b>\n                {currentEnquiry.noOfGuests}\n                <br />\n                <b>Services Required: </b>\n                {currentEnquiry.servicesRequired}\n                <br />\n                <b>Location: </b>\n                {currentEnquiry.locality} in {currentEnquiry.city}\n                <br />\n                <b>Budget: </b>{\" \"}\n                {currentEnquiry.budgetRange.to !== 0\n                  ? \"Rs.\" +\n                    currentEnquiry.budgetRange.from\n                      .toString()\n                      .replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\") +\n                    \" - Rs.\" +\n                    currentEnquiry.budgetRange.to\n                      .toString()\n                      .replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\")\n                  : \"Above Rs.\" +\n                    currentEnquiry.budgetRange.from\n                      .toString()\n                      .replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\")}\n                <br />\n                <b>Other Info: </b>\n                {currentEnquiry.otherInfo}\n                <br />\n                <b>CelebratON Comments: </b>\n                {currentEnquiry.celebratonComments}\n              </Col>\n              <Col\n                style={{ textAlign: \"center\" }}\n                md={{ span: 12 }}\n                sm={{ span: 24 }}\n                xs={{ span: 24 }}\n              >\n                {typeof currentEnquiry.interestedPartners != \"undefined\" &&\n                currentEnquiry.interestedPartners.includes(\n                  this.state.profile._id\n                ) ? (\n                  <React.Fragment>\n                    <h2>\n                      <u>Customer Contact</u>\n                    </h2>\n                    <b>Name: </b>\n                    {currentEnquiry.user.name}\n                    <br />\n                    <b>Mobile: </b>\n                    {currentEnquiry.user.mobile}\n                    <br />\n                    <b>Email: </b>\n                    {currentEnquiry.user.email}\n                    <br />\n                    <br />\n                    <a href={`tel:+91${currentEnquiry.user.mobile}`}>\n                      <Button\n                        type=\"primary\"\n                        icon=\"mobile\"\n                        size=\"large\"\n                        style={{\n                          background: \"green\",\n                          borderColor: \"green\"\n                        }}\n                      >\n                        Call\n                      </Button>\n                    </a>\n                    {\"  \"}\n                    <a href={`mailto:${currentEnquiry.user.email}`}>\n                      <Button\n                        type=\"primary\"\n                        size=\"default\"\n                        icon=\"mail\"\n                        size=\"large\"\n                        style={{ background: \"orange\", borderColor: \"orange\" }}\n                      >\n                        Mail\n                      </Button>\n                    </a>\n                  </React.Fragment>\n                ) : (\n                  <React.Fragment>\n                    <h2>\n                      <u>Pricing Info</u>\n                    </h2>\n                    <b>Lead Price: </b>\n                    Rs.{currentEnquiry.leadAmount}\n                    <br />\n                    <b>Wallet Balance: </b>\n                    Rs.{this.state.profile.Wallet}\n                    <br />\n                    <b>Promotional Credit: </b>\n                    Rs.{this.state.profile.promoCredit}\n                    <br />\n                    <br />\n                    <Button\n                      type=\"primary\"\n                      icon=\"caret-right\"\n                      size=\"large\"\n                      style={{ background: \"green\", borderColor: \"green\" }}\n                      onClick={() => this.payForLead()}\n                    >\n                      Pay Rs.{currentEnquiry.leadAmount}\n                    </Button>\n                    <br />\n                    <br />\n                    <Button\n                      type=\"danger\"\n                      size=\"default\"\n                      icon=\"heart\"\n                      size=\"large\"\n                      // style={{ background: \"red\", borderColor: \"red\" }}\n                    >\n                      Add to Wishlist\n                    </Button>\n                  </React.Fragment>\n                )}\n              </Col>\n            </Row>\n          </Modal>\n          <style jsx>{`\n            a {\n              text-decoration: none;\n            }\n          `}</style>\n        </div>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default withRouter(AllEnquiries);\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAcA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AACA;AAwCA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AACA;AAGA;AACA;AACA;AAAA;AAEA;AACA;AAFA;AAKA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AAIA;AAQA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAUA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAQA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAWA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AADA;AAGA;AACA;AADA;AA7CA;AAkDA;AACA;AACA;AACA;;;;;;AAzKA;;;AAYA;AACA;AACA;AADA;AAGA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AAKA;AACA;AAAA;AAAA;AADA;AAIA;AACA;AACA;AAEA;AACA;;;AAiIA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAEA;AAGA;AACA;AACA;AACA;AACA;AAJA;AADA;AAQA;AAAA;AAZA;AAAA;AAmBA;AAEA;AAAA;AAAA;AACA;AAEA;AAAA;AAAA;AAAA;AAEA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAFA;AAJA;AASA;AAAA;AAAA;AAAA;AAEA;AAAA;AAGA;AAAA;AACA;AAAA;AAKA;AAIA;AACA;AACA;AACA;AAHA;AALA;AAxBA;AAhBA;AA4DA;AACA;AACA;AACA;AAAA;AAAA;AACA;AALA;AAOA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAHA;AAKA;AAAA;AAEA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAcA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAIA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAJA;AAWA;AAAA;AACA;AAAA;AAEA;AAAA;AAEA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAFA;AAJA;AAaA;AAAA;AAAA;AAEA;AACA;AACA;AAHA;AAKA;AAAA;AAAA;AAQA;AAAA;AACA;AAAA;AAEA;AAAA;AAEA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AALA;AASA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AAHA;AA7LA;AAAA;AAAA;AAmNA;;;;AAzZA;AACA;AA2ZA;;;;A","sourceRoot":""}